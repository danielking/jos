(function() {
  angular.module('jos').controller('com.jedisto.jos.app.notebook.MainController', [
    '$scope', '$filter', 'storage', function($scope, $filter, storage) {
      var path;
      path = '/apps/jedios/com.jedisto.jos.app.notebook';
      $scope.notes = [];
      $scope.loading = false;
      async.auto({
        mkdir: function(cb) {
          $scope.loading = true;
          return storage.personal.mkdir(path).then(function() {
            return cb(null, true);
          }, function(error) {
            if (error.code === 31061) {
              return cb(null, null);
            } else {
              $scope.loading = false;
              return console.log(error);
            }
          });
        },
        list: [
          'mkdir', function(cb, result) {
            if (result.mkdir) {
              $scope.notes = [];
              return $scope.loading = false;
            } else {
              return storage.personal.list(path).then(function(entries) {
                $scope.loading = false;
                return $scope.notes = entries.list;
              }, function(error) {
                $scope.loading = false;
                return console.log(error);
              });
            }
          }
        ]
      });
      return $scope.note = {
        "new": function() {
          var content;
          if ($scope.note.editing) {
            return;
          }
          content = $filter('date')(new Date(), '笔记 @ yyyy-MM-dd hh:mm:ss');
          return storage.personal.upload(content, path + '/note').then(function(entry) {
            $scope.notes = [entry].concat($scope.notes);
            return $scope.note.open(entry);
          }, function(error) {
            return console.log(error);
          });
        },
        edit: function() {
          $scope.note.editing_origin_content = $scope.note.selected.content;
          return $scope.note.editing = true;
        },
        cancel: function() {
          $scope.note.selected.content = $scope.note.editing_origin_content;
          return $scope.note.editing = false;
        },
        "delete": function() {
          return bootbox.confirm('确定删除?', function(ok) {
            if (ok) {
              return storage.personal.deleteFile($scope.note.selected.path).then(function(entry) {
                var idx;
                console.log(entry);
                idx = $scope.notes.indexOf($scope.note.selected);
                $scope.notes = $scope.notes.slice(0, idx).concat($scope.notes.slice(idx + 1));
                $scope.note.selected = null;
                return $scope.note.editing = false;
              }, function(error) {
                return console.log(error);
              });
            }
          });
        },
        save: function() {
          return storage.personal.upload($scope.note.selected.content, $scope.note.selected.path, {
            ondup: 'overwrite'
          }).then(function(entry) {
            var k, v;
            for (k in entry) {
              v = entry[k];
              $scope.note.selected[k] = v;
            }
            return $scope.note.editing = null;
          });
        },
        open: function(note) {
          if ($scope.note.editing) {
            return;
          }
          if ($scope.note.selected === note) {
            return $scope.note.selected = null;
          } else {
            $scope.note.selected = note;
            note.created_at = new Date(note.ctime * 1000);
            note.updated_at = new Date(note.mtime * 1000);
            if (!note.loaded) {
              return storage.personal.getFileUrl(note.path).then(function(url) {
                note.url = url;
                return $.ajax({
                  url: url,
                  dataType: 'text',
                  success: function(content) {
                    return $scope.$apply(function() {
                      note.content = content;
                      return note.loaded = true;
                    });
                  }
                });
              });
            }
          }
        }
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=data:application/json;base64,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QUEsQ0FBSyxJQUFJLENBQUMsS0FBTCxHQUFhLElBQWxCLENBRHRCLENBQUE7QUFBQSxZQUVBLElBQUksQ0FBQyxVQUFMLEdBQXNCLElBQUEsSUFBQSxDQUFLLElBQUksQ0FBQyxLQUFMLEdBQWEsSUFBbEIsQ0FGdEIsQ0FBQTtBQUdBLFlBQUEsSUFBQSxDQUFBLElBQVcsQ0FBQyxNQUFaO3FCQUNDLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBakIsQ0FBNEIsSUFBSSxDQUFDLElBQWpDLENBQ0MsQ0FBQyxJQURGLENBQ08sU0FBQyxHQUFELEdBQUE7QUFDTCxnQkFBQSxJQUFJLENBQUMsR0FBTCxHQUFXLEdBQVgsQ0FBQTt1QkFDQSxDQUFDLENBQUMsSUFBRixDQUNDO0FBQUEsa0JBQUEsR0FBQSxFQUFLLEdBQUw7QUFBQSxrQkFDQSxRQUFBLEVBQVUsTUFEVjtBQUFBLGtCQUVBLE9BQUEsRUFBUyxTQUFDLE9BQUQsR0FBQTsyQkFDUixNQUFNLENBQUMsTUFBUCxDQUFjLFNBQUEsR0FBQTtBQUNiLHNCQUFBLElBQUksQ0FBQyxPQUFMLEdBQWUsT0FBZixDQUFBOzZCQUNBLElBQUksQ0FBQyxNQUFMLEdBQWMsS0FGRDtvQkFBQSxDQUFkLEVBRFE7a0JBQUEsQ0FGVDtpQkFERCxFQUZLO2NBQUEsQ0FEUCxFQUREO2FBTkQ7V0FGSztRQUFBLENBakNOO1FBL0JGO0lBQUEsQ0FGK0U7R0FBaEYsQ0FBQSxDQUFBO0FBQUEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdqb3MnKS5jb250cm9sbGVyICdjb20uamVkaXN0by5qb3MuYXBwLm5vdGVib29rLk1haW5Db250cm9sbGVyJywgW1xyXG5cdCckc2NvcGUnLCAnJGZpbHRlcicsICdzdG9yYWdlJyxcclxuXHQoJHNjb3BlLCAkZmlsdGVyLCBzdG9yYWdlKSAtPlxyXG5cdFx0cGF0aCA9ICcvYXBwcy9qZWRpb3MvY29tLmplZGlzdG8uam9zLmFwcC5ub3RlYm9vaydcclxuXHRcdCRzY29wZS5ub3RlcyA9IFtdXHJcblx0XHQkc2NvcGUubG9hZGluZyA9IGZhbHNlXHJcblxyXG5cdFx0YXN5bmMuYXV0b1xyXG5cdFx0XHRta2RpcjogKGNiKSAtPlxyXG5cdFx0XHRcdCRzY29wZS5sb2FkaW5nID0gdHJ1ZVxyXG5cdFx0XHRcdHN0b3JhZ2UucGVyc29uYWwubWtkaXIgcGF0aFxyXG5cdFx0XHRcdFx0LnRoZW4gLT5cclxuXHRcdFx0XHRcdFx0XHRjYiBudWxsLCB0cnVlXHJcblx0XHRcdFx0XHRcdCwgKGVycm9yKSAtPlxyXG5cdFx0XHRcdFx0XHRcdGlmIGVycm9yLmNvZGUgPT0gMzEwNjFcclxuXHRcdFx0XHRcdFx0XHRcdGNiIG51bGwsIG51bGxcclxuXHRcdFx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdFx0XHQkc2NvcGUubG9hZGluZyA9IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyBlcnJvclxyXG5cdFx0XHRsaXN0OiBbJ21rZGlyJywgKGNiLCByZXN1bHQpIC0+XHJcblx0XHRcdFx0aWYgcmVzdWx0Lm1rZGlyXHJcblx0XHRcdFx0XHQkc2NvcGUubm90ZXMgPSBbXVxyXG5cdFx0XHRcdFx0JHNjb3BlLmxvYWRpbmcgPSBmYWxzZVxyXG5cdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdHN0b3JhZ2UucGVyc29uYWwubGlzdCBwYXRoXHJcblx0XHRcdFx0XHRcdC50aGVuIChlbnRyaWVzKSAtPlxyXG5cdFx0XHRcdFx0XHRcdFx0JHNjb3BlLmxvYWRpbmcgPSBmYWxzZVxyXG5cdFx0XHRcdFx0XHRcdFx0JHNjb3BlLm5vdGVzID0gZW50cmllcy5saXN0XHJcblx0XHRcdFx0XHRcdFx0LCAoZXJyb3IpIC0+XHJcblx0XHRcdFx0XHRcdFx0XHQkc2NvcGUubG9hZGluZyA9IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyBlcnJvclxyXG5cdFx0XHRdXHJcblx0XHQkc2NvcGUubm90ZSA9IFxyXG5cdFx0XHRuZXc6IC0+XHJcblx0XHRcdFx0cmV0dXJuIGlmICRzY29wZS5ub3RlLmVkaXRpbmdcclxuXHRcdFx0XHRjb250ZW50ID0gJGZpbHRlcignZGF0ZScpIG5ldyBEYXRlKCksICfnrJTorrAgQCB5eXl5LU1NLWRkIGhoOm1tOnNzJ1xyXG5cdFx0XHRcdHN0b3JhZ2UucGVyc29uYWwudXBsb2FkIGNvbnRlbnQsIHBhdGggKyAnL25vdGUnXHJcblx0XHRcdFx0XHQudGhlbiAoZW50cnkpIC0+XHJcblx0XHRcdFx0XHRcdFx0JHNjb3BlLm5vdGVzID0gW2VudHJ5XS5jb25jYXQgJHNjb3BlLm5vdGVzXHJcblx0XHRcdFx0XHRcdFx0JHNjb3BlLm5vdGUub3BlbiBlbnRyeVxyXG5cdFx0XHRcdFx0XHQsIChlcnJvcikgLT5cclxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyBlcnJvclxyXG5cdFx0XHRlZGl0OiAtPlxyXG5cdFx0XHRcdCRzY29wZS5ub3RlLmVkaXRpbmdfb3JpZ2luX2NvbnRlbnQgPSAkc2NvcGUubm90ZS5zZWxlY3RlZC5jb250ZW50XHJcblx0XHRcdFx0JHNjb3BlLm5vdGUuZWRpdGluZyA9IHRydWVcclxuXHRcdFx0Y2FuY2VsOiAtPlxyXG5cdFx0XHRcdCRzY29wZS5ub3RlLnNlbGVjdGVkLmNvbnRlbnQgPSAkc2NvcGUubm90ZS5lZGl0aW5nX29yaWdpbl9jb250ZW50XHJcblx0XHRcdFx0JHNjb3BlLm5vdGUuZWRpdGluZyA9IGZhbHNlXHJcblx0XHRcdGRlbGV0ZTogLT5cclxuXHRcdFx0XHRib290Ym94LmNvbmZpcm0gJ+ehruWumuWIoOmZpD8nLCAob2spIC0+XHJcblx0XHRcdFx0XHRpZiBva1xyXG5cdFx0XHRcdFx0XHRzdG9yYWdlLnBlcnNvbmFsLmRlbGV0ZUZpbGUgJHNjb3BlLm5vdGUuc2VsZWN0ZWQucGF0aFxyXG5cdFx0XHRcdFx0XHRcdC50aGVuIChlbnRyeSkgLT5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2cgZW50cnlcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWR4ID0gJHNjb3BlLm5vdGVzLmluZGV4T2YgJHNjb3BlLm5vdGUuc2VsZWN0ZWRcclxuXHRcdFx0XHRcdFx0XHRcdFx0JHNjb3BlLm5vdGVzID0gJHNjb3BlLm5vdGVzLnNsaWNlKDAsIGlkeCkuY29uY2F0ICRzY29wZS5ub3Rlcy5zbGljZShpZHggKyAxKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHQkc2NvcGUubm90ZS5zZWxlY3RlZCA9IG51bGxcclxuXHRcdFx0XHRcdFx0XHRcdFx0JHNjb3BlLm5vdGUuZWRpdGluZyA9IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHQsIChlcnJvcikgLT5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2cgZXJyb3JcclxuXHRcdFx0c2F2ZTogLT5cclxuXHRcdFx0XHRzdG9yYWdlLnBlcnNvbmFsLnVwbG9hZCAkc2NvcGUubm90ZS5zZWxlY3RlZC5jb250ZW50LCAkc2NvcGUubm90ZS5zZWxlY3RlZC5wYXRoLCBvbmR1cDogJ292ZXJ3cml0ZSdcclxuXHRcdFx0XHRcdC50aGVuIChlbnRyeSkgLT5cclxuXHRcdFx0XHRcdFx0Zm9yIGssIHYgb2YgZW50cnlcclxuXHRcdFx0XHRcdFx0XHQkc2NvcGUubm90ZS5zZWxlY3RlZFtrXSA9IHZcclxuXHRcdFx0XHRcdFx0JHNjb3BlLm5vdGUuZWRpdGluZyA9IG51bGxcclxuXHRcdFx0b3BlbjogKG5vdGUpIC0+XHJcblx0XHRcdFx0cmV0dXJuIGlmICRzY29wZS5ub3RlLmVkaXRpbmdcclxuXHRcdFx0XHRpZiAkc2NvcGUubm90ZS5zZWxlY3RlZCA9PSBub3RlXHJcblx0XHRcdFx0XHQkc2NvcGUubm90ZS5zZWxlY3RlZCA9IG51bGxcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHQkc2NvcGUubm90ZS5zZWxlY3RlZCA9IG5vdGVcclxuXHRcdFx0XHRcdG5vdGUuY3JlYXRlZF9hdCA9IG5ldyBEYXRlKG5vdGUuY3RpbWUgKiAxMDAwKVxyXG5cdFx0XHRcdFx0bm90ZS51cGRhdGVkX2F0ID0gbmV3IERhdGUobm90ZS5tdGltZSAqIDEwMDApXHJcblx0XHRcdFx0XHR1bmxlc3Mgbm90ZS5sb2FkZWRcclxuXHRcdFx0XHRcdFx0c3RvcmFnZS5wZXJzb25hbC5nZXRGaWxlVXJsIG5vdGUucGF0aFxyXG5cdFx0XHRcdFx0XHRcdC50aGVuICh1cmwpIC0+XHJcblx0XHRcdFx0XHRcdFx0XHRub3RlLnVybCA9IHVybFxyXG5cdFx0XHRcdFx0XHRcdFx0JC5hamF4XHJcblx0XHRcdFx0XHRcdFx0XHRcdHVybDogdXJsXHJcblx0XHRcdFx0XHRcdFx0XHRcdGRhdGFUeXBlOiAndGV4dCdcclxuXHRcdFx0XHRcdFx0XHRcdFx0c3VjY2VzczogKGNvbnRlbnQpIC0+XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0JHNjb3BlLiRhcHBseSAtPlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bm90ZS5jb250ZW50ID0gY29udGVudFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bm90ZS5sb2FkZWQgPSB0cnVlXHJcbl1cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9